# N-Defender GREEN SIGNAL Report

Generated: $(date -u +%Y-%m-%dT%H:%M:%SZ)

## REST Endpoints (Local vs Public)
| Endpoint | Local (HTTP) | Public (HTTP) | Notes |
| --- | --- | --- | --- |
| health | PASS 200 | FAIL 403 | Public blocked for non-browser clients in diagnostics |
| status | PASS 200 | FAIL 403 | Public blocked for non-browser clients in diagnostics |
| contacts | PASS 200 | FAIL 403 | Public blocked for non-browser clients in diagnostics |
| system | PASS 200 | FAIL 403 | Public blocked for non-browser clients in diagnostics |
| power | PASS 200 | FAIL 403 | Public blocked for non-browser clients in diagnostics |
| rf | PASS 200 | FAIL 403 | Public blocked for non-browser clients in diagnostics |
| video | PASS 200 | FAIL 403 | Public blocked for non-browser clients in diagnostics |
| services | PASS 200 | FAIL 403 | Public blocked for non-browser clients in diagnostics |
| network | PASS 200 | FAIL 403 | Public blocked for non-browser clients in diagnostics |
| audio | PASS 200 | FAIL 403 | Public blocked for non-browser clients in diagnostics |

Local diagnostics: `reports/diagnostics_20260222_141936.md`
Public diagnostics: `reports/diagnostics_20260222_141943.md`

## WebSocket Results
| Target | Result | First Type | First 200 Chars |
| --- | --- | --- | --- |
| Public `wss://n.flyspark.in/api/v1/ws` | PASS | CONTACT_NEW | {"type":"CONTACT_NEW","timestamp":1771770065473,"source":"rf_sensor","data":{"id":"rf:3158000000","type":"UNKNOWN_RF","last_seen_ts":1771770065208,"unknown_rf":{"center_hz":3158000000,"snr_db":11.6073 |
| Local `ws://127.0.0.1:8000/api/v1/ws` | PASS | CONTACT_NEW | {"type":"CONTACT_NEW","timestamp":1771770014757,"source":"rf_sensor","data":{"id":"rf:2488000000","type":"UNKNOWN_RF","last_seen_ts":1771770014577,"unknown_rf":{"center_hz":2488000000,"snr_db":12.1356 |

## CORS (Public)
Request: OPTIONS `https://n.flyspark.in/api/v1/status`
- Status: 200
- access-control-allow-origin: *
- access-control-allow-methods: GET,POST,OPTIONS
- access-control-allow-headers: Content-Type,X-API-Key,X-Role

## Key Fields Check (/status)
Required keys: system, power, services, rf, network, audio, contacts
- Local missing: none
- Public missing: none (curl parse)

## Systemd + Logs
- `systemctl is-active ndefender-backend` -> active
- `systemctl is-active cloudflared` -> active
- ERROR/EXCEPTION/TRACEBACK lines in last 200 log lines: none found

## UI Not Available - Likely Causes
1. Public REST for non-browser clients still blocked by Cloudflare (diagnostics 403). If UI uses a non-browser client or proxy without UA, it will fail to load data.
2. UI base URL mismatch (should be `https://n.flyspark.in/api/v1` for public, not `/api/v1` or `http://`).
3. WS URL mismatch (should be `wss://n.flyspark.in/api/v1/ws` for public).
4. If UI depends on diagnostics/health checks (non-browser fetch), it may mark data as unavailable despite browser fetch working.

## Conclusion
**RED SIGNAL**
Public REST diagnostics still FAIL with HTTP 403 (Cloudflare blocking non-browser clients). Public WS is OK; Local REST+WS are OK. This is not yet fully green.

## Fix List
1) Ensure Cloudflare WAF Skip rule is applied to correct zone and ordered at highest priority.
2) Skip components must include Managed Rules, Browser Integrity Check, Bot Fight Mode / Super Bot Fight Mode.
3) Re-run public diagnostics once rule is confirmed active.
