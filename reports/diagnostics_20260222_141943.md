# N-Defender Diagnostics Report

Base URL: `https://n.flyspark.in/api/v1`
Generated: `2026-02-22T14:19:51.773905+00:00`

## Summary
| Endpoint | Status | HTTP | Latency (ms) |
| --- | --- | --- | --- |
| `health` | FAIL | 403 | 758 |
| `status` | FAIL | 403 | 762 |
| `contacts` | FAIL | 403 | 475 |
| `system` | FAIL | 403 | 796 |
| `power` | FAIL | 403 | 515 |
| `rf` | FAIL | 403 | 485 |
| `video` | FAIL | 403 | 423 |
| `services` | FAIL | 403 | 835 |
| `network` | FAIL | 403 | 573 |
| `audio` | FAIL | 403 | 470 |

## Health Probe Attempts
- `https://n.flyspark.in/api/v1/health` -> FAIL (403)
- `https://n.flyspark.in/health` -> FAIL (403)

## CORS Preflight
URL: `https://n.flyspark.in/api/v1/status`
Status: `FAIL` HTTP `403`
Allow-Origin: `None`
Allow-Methods: `None`
Allow-Headers: `None`
Error: `HTTP Error 403: Forbidden`

## WebSocket
URL: `wss://n.flyspark.in/api/v1/ws`
Status: `PASS`
Messages received: `3`
Envelope ok: `True`
First message:
```
{"type":"CONTACT_NEW","timestamp":1771769991304,"source":"rf_sensor","data":{"id":"rf:5862000000","type":"UNKNOWN_RF","last_seen_ts":1771769990992,"unknown_rf":{"center_hz":5862000000,"snr_db":11.635580183256408,"peak_db":79.24013084597577,"bandwidth_class":"narrow","family_hint":"unknown"}}}
```

## Systemd Status
- `ndefender-backend`: `active` error=`None`
- `cloudflared`: `active` error=`None`
- `ndefender-kiosk`: `active` error=`None`

## Journal Snippets
### ndefender-backend
```
d_name=drone_detected_alarm exit_code=1 timed_out=False ok=False
Feb 22 19:49:45 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:45] "GET /api/v1/health HTTP/1.1" 200 -
Feb 22 19:49:45 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:45] "GET /api/v1/status HTTP/1.1" 200 -
Feb 22 19:49:48 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:48] "GET /api/v1/health HTTP/1.1" 200 -
Feb 22 19:49:48 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:48] "GET /api/v1/status HTTP/1.1" 200 -
Feb 22 19:49:48 ndefender-pi python[3950898]: PLAY_SOUND req_id=u_mlxu3p3c_z6_37lw9 sound_name=drone_detected_alarm exit_code=1 timed_out=False ok=False
Feb 22 19:49:49 ndefender-pi python[3950898]: PLAY_SOUND req_id=u_mlxu3sxn_yx_821i1 sound_name=drone_detected_alarm exit_code=1 timed_out=False ok=False
Feb 22 19:49:50 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:50] "GET /api/v1/health HTTP/1.1" 200 -
Feb 22 19:49:51 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:51] "GET /api/v1/status HTTP/1.1" 200 -
Feb 22 19:49:51 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:51] "GET /api/v1/ws HTTP/1.1" 200 -

```
### cloudflared
Highlights:
- Feb 22 16:51:20 ndefender-pi cloudflared[3895612]: 2026-02-22T11:21:20Z ERR  error="Incoming request ended abruptly: context canceled" connIndex=1 event=1 ingressRule=0 originService=http://127.0.0.1:8000
- Feb 22 16:51:20 ndefender-pi cloudflared[3895612]: 2026-02-22T11:21:20Z ERR Request failed error="Incoming request ended abruptly: context canceled" connIndex=1 dest=https://n.flyspark.in/api/v1 event=0 ip=198.41.192.57 type=http
```
Feb 22 16:51:20 ndefender-pi cloudflared[3895612]: 2026-02-22T11:21:20Z ERR  error="Incoming request ended abruptly: context canceled" connIndex=1 event=1 ingressRule=0 originService=http://127.0.0.1:8000
Feb 22 16:51:20 ndefender-pi cloudflared[3895612]: 2026-02-22T11:21:20Z ERR Request failed error="Incoming request ended abruptly: context canceled" connIndex=1 dest=https://n.flyspark.in/api/v1 event=0 ip=198.41.192.57 type=http

```

## Why UI Blank (Top 5 Causes)
- API /status failing — evidence: `/status HTTP=403 err=HTTP Error 403: Forbidden`
- API /health failing — evidence: `/health HTTP=403 err=HTTP Error 403: Forbidden`
- CORS preflight blocked — evidence: `allow_origin=None http=403`
- journal warnings in cloudflared — evidence: `error/exception/traceback/ws lines detected`

## Endpoint Details
### health
URL: `https://n.flyspark.in/api/v1/health`
Status: `FAIL`
HTTP: `403`
Latency: `758` ms
Content-Type: `text/plain; charset=UTF-8`
Error: `HTTP Error 403: Forbidden`
Snippet:
```
error code: 1010
```
### status
URL: `https://n.flyspark.in/api/v1/status`
Status: `FAIL`
HTTP: `403`
Latency: `762` ms
Content-Type: `text/plain; charset=UTF-8`
Error: `HTTP Error 403: Forbidden`
Snippet:
```
error code: 1010
```
### contacts
URL: `https://n.flyspark.in/api/v1/contacts`
Status: `FAIL`
HTTP: `403`
Latency: `475` ms
Content-Type: `text/plain; charset=UTF-8`
Error: `HTTP Error 403: Forbidden`
Snippet:
```
error code: 1010
```
### system
URL: `https://n.flyspark.in/api/v1/system`
Status: `FAIL`
HTTP: `403`
Latency: `796` ms
Content-Type: `text/plain; charset=UTF-8`
Error: `HTTP Error 403: Forbidden`
Snippet:
```
error code: 1010
```
### power
URL: `https://n.flyspark.in/api/v1/power`
Status: `FAIL`
HTTP: `403`
Latency: `515` ms
Content-Type: `text/plain; charset=UTF-8`
Error: `HTTP Error 403: Forbidden`
Snippet:
```
error code: 1010
```
### rf
URL: `https://n.flyspark.in/api/v1/rf`
Status: `FAIL`
HTTP: `403`
Latency: `485` ms
Content-Type: `text/plain; charset=UTF-8`
Error: `HTTP Error 403: Forbidden`
Snippet:
```
error code: 1010
```
### video
URL: `https://n.flyspark.in/api/v1/video`
Status: `FAIL`
HTTP: `403`
Latency: `423` ms
Content-Type: `text/plain; charset=UTF-8`
Error: `HTTP Error 403: Forbidden`
Snippet:
```
error code: 1010
```
### services
URL: `https://n.flyspark.in/api/v1/services`
Status: `FAIL`
HTTP: `403`
Latency: `835` ms
Content-Type: `text/plain; charset=UTF-8`
Error: `HTTP Error 403: Forbidden`
Snippet:
```
error code: 1010
```
### network
URL: `https://n.flyspark.in/api/v1/network`
Status: `FAIL`
HTTP: `403`
Latency: `573` ms
Content-Type: `text/plain; charset=UTF-8`
Error: `HTTP Error 403: Forbidden`
Snippet:
```
error code: 1010
```
### audio
URL: `https://n.flyspark.in/api/v1/audio`
Status: `FAIL`
HTTP: `403`
Latency: `470` ms
Content-Type: `text/plain; charset=UTF-8`
Error: `HTTP Error 403: Forbidden`
Snippet:
```
error code: 1010
```