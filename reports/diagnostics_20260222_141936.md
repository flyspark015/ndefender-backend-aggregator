# N-Defender Diagnostics Report

Base URL: `http://127.0.0.1:8000/api/v1`
Generated: `2026-02-22T14:19:38.866600+00:00`

## Summary
| Endpoint | Status | HTTP | Latency (ms) |
| --- | --- | --- | --- |
| `health` | PASS | 200 | 6 |
| `status` | PASS | 200 | 721 |
| `contacts` | PASS | 200 | 9 |
| `system` | PASS | 200 | 20 |
| `power` | PASS | 200 | 5 |
| `rf` | PASS | 200 | 5 |
| `video` | PASS | 200 | 6 |
| `services` | PASS | 200 | 251 |
| `network` | PASS | 200 | 547 |
| `audio` | PASS | 200 | 111 |

## Health Probe Attempts
- `http://127.0.0.1:8000/api/v1/health` -> PASS (200)

## CORS Preflight
URL: `http://127.0.0.1:8000/api/v1/status`
Status: `PASS` HTTP `200`
Allow-Origin: `*`
Allow-Methods: `GET,POST,OPTIONS`
Allow-Headers: `Content-Type,X-API-Key,X-Role`

## WebSocket
URL: `ws://127.0.0.1:8000/api/v1/ws`
Status: `PASS`
Messages received: `3`
Envelope ok: `True`
First message:
```
{"type":"CONTACT_NEW","timestamp":1771769978689,"source":"rf_sensor","data":{"id":"rf:5768000000","type":"UNKNOWN_RF","last_seen_ts":1771769978399,"unknown_rf":{"center_hz":5768000000,"snr_db":15.819018047840558,"peak_db":83.38114327478371,"bandwidth_class":"narrow","family_hint":"unknown"}}}
```

## Systemd Status
- `ndefender-backend`: `active` error=`None`
- `cloudflared`: `active` error=`None`
- `ndefender-kiosk`: `active` error=`None`

## Journal Snippets
### ndefender-backend
```
fender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:37] "GET /api/v1/power HTTP/1.1" 200 -
Feb 22 19:49:37 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:37] "GET /api/v1/rf HTTP/1.1" 200 -
Feb 22 19:49:37 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:37] "GET /api/v1/video HTTP/1.1" 200 -
Feb 22 19:49:37 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:37] "GET /api/v1/status HTTP/1.1" 200 -
Feb 22 19:49:37 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:37] "GET /api/v1/services HTTP/1.1" 200 -
Feb 22 19:49:38 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:38] "GET /api/v1/network HTTP/1.1" 200 -
Feb 22 19:49:38 ndefender-pi python[3950898]: PLAY_SOUND req_id=u_mlxu3gt4_z4_75mlj sound_name=drone_detected_alarm exit_code=0 timed_out=False ok=True
Feb 22 19:49:38 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:38] "GET /api/v1/audio HTTP/1.1" 200 -
Feb 22 19:49:38 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:38] "OPTIONS /api/v1/status HTTP/1.1" 200 -
Feb 22 19:49:38 ndefender-pi python[3950898]: 127.0.0.1 - - [22/Feb/2026 19:49:38] "GET /api/v1/ws HTTP/1.1" 200 -

```
### cloudflared
Highlights:
- Feb 22 16:51:20 ndefender-pi cloudflared[3895612]: 2026-02-22T11:21:20Z ERR  error="Incoming request ended abruptly: context canceled" connIndex=1 event=1 ingressRule=0 originService=http://127.0.0.1:8000
- Feb 22 16:51:20 ndefender-pi cloudflared[3895612]: 2026-02-22T11:21:20Z ERR Request failed error="Incoming request ended abruptly: context canceled" connIndex=1 dest=https://n.flyspark.in/api/v1 event=0 ip=198.41.192.57 type=http
```
Feb 22 16:51:20 ndefender-pi cloudflared[3895612]: 2026-02-22T11:21:20Z ERR  error="Incoming request ended abruptly: context canceled" connIndex=1 event=1 ingressRule=0 originService=http://127.0.0.1:8000
Feb 22 16:51:20 ndefender-pi cloudflared[3895612]: 2026-02-22T11:21:20Z ERR Request failed error="Incoming request ended abruptly: context canceled" connIndex=1 dest=https://n.flyspark.in/api/v1 event=0 ip=198.41.192.57 type=http

```

## Why UI Blank (Top 5 Causes)
- journal warnings in cloudflared â€” evidence: `error/exception/traceback/ws lines detected`

## Endpoint Details
### health
URL: `http://127.0.0.1:8000/api/v1/health`
Status: `PASS`
HTTP: `200`
Latency: `6` ms
Content-Type: `application/json`
Present keys: `status, timestamp_ms`
Snippet:
```
{"status":"ok","timestamp_ms":1771769976901}

```
### status
URL: `http://127.0.0.1:8000/api/v1/status`
Status: `PASS`
HTTP: `200`
Latency: `721` ms
Content-Type: `application/json`
Present keys: `timestamp_ms, system, power, rf, video, services, network, audio, contacts`
Snippet:
```
{"audio":{"muted":false,"volume_percent":100},"contacts":[{"id":"rf:5754000000","last_seen_ts":1771769976532,"type":"UNKNOWN_RF","unknown_rf":{"bandwidth_class":"narrow","center_hz":5754000000,"family_hint":"unknown","peak_db":79.90281375183935,"snr_db":12.391170287848851}},{"id":"rf:5752000000","la
```
### contacts
URL: `http://127.0.0.1:8000/api/v1/contacts`
Status: `PASS`
HTTP: `200`
Latency: `9` ms
Content-Type: `application/json`
Present keys: `contacts`
Snippet:
```
{"contacts":[{"id":"rf:5760000000","last_seen_ts":1771769977381,"type":"UNKNOWN_RF","unknown_rf":{"bandwidth_class":"narrow","center_hz":5760000000,"family_hint":"unknown","peak_db":79.40674988946456,"snr_db":11.837061538726289}},{"id":"rf:5758000000","last_seen_ts":1771769977074,"type":"UNKNOWN_RF"
```
### system
URL: `http://127.0.0.1:8000/api/v1/system`
Status: `PASS`
HTTP: `200`
Latency: `20` ms
Content-Type: `application/json`
Present keys: `uptime_s, cpu_temp_c, cpu_usage_percent, load_1m, load_5m, load_15m, ram_used_mb, ram_total_mb, disk_used_gb, disk_total_gb, throttled_flags, status`
Snippet:
```
{"cpu_temp_c":60.05,"cpu_usage_percent":64.76717889606167,"disk_total_gb":117,"disk_used_gb":69,"load_15m":6.29541015625,"load_1m":7.0126953125,"load_5m":6.2490234375,"ram_total_mb":16215,"ram_used_mb":6948,"status":"ok","throttled_flags":0,"uptime_s":353258}

```
### power
URL: `http://127.0.0.1:8000/api/v1/power`
Status: `PASS`
HTTP: `200`
Latency: `5` ms
Content-Type: `application/json`
Present keys: `pack_voltage_v, current_a, input_vbus_v, input_power_w, soc_percent, time_to_empty_s, time_to_full_s, per_cell_v, state, status`
Snippet:
```
{"current_a":null,"input_power_w":null,"input_vbus_v":null,"pack_voltage_v":null,"per_cell_v":null,"soc_percent":null,"state":null,"status":"degraded","time_to_empty_s":null,"time_to_full_s":null}

```
### rf
URL: `http://127.0.0.1:8000/api/v1/rf`
Status: `PASS`
HTTP: `200`
Latency: `5` ms
Content-Type: `application/json`
Present keys: `last_event_type, last_event, last_timestamp_ms, status`
Snippet:
```
{"last_event":{"id":"rf:5740000000","last_seen_ts":1771769977405,"type":"UNKNOWN_RF","unknown_rf":{"bandwidth_class":"narrow","center_hz":5740000000,"family_hint":"unknown","peak_db":78.69703938185572,"snr_db":11.164836652125928}},"last_event_type":"CONTACT_LOST","last_timestamp_ms":1771769977405,"s
```
### video
URL: `http://127.0.0.1:8000/api/v1/video`
Status: `PASS`
HTTP: `200`
Latency: `6` ms
Content-Type: `application/json`
Present keys: `selected, status`
Snippet:
```
{"selected":1,"status":"ok"}

```
### services
URL: `http://127.0.0.1:8000/api/v1/services`
Status: `PASS`
HTTP: `200`
Latency: `251` ms
Content-Type: `application/json`
Present keys: `name, active_state, sub_state, restart_count`
Snippet:
```
[{"active_state":"active","name":"ndefender-backend","restart_count":0,"sub_state":"running"},{"active_state":"active","name":"ndefender-kiosk","restart_count":0,"sub_state":"running"},{"active_state":"active","name":"ndefender-remoteid-engine","restart_count":100260,"sub_state":"running"},{"active_
```
### network
URL: `http://127.0.0.1:8000/api/v1/network`
Status: `PASS`
HTTP: `200`
Latency: `547` ms
Content-Type: `application/json`
Present keys: `connected, ssid, ip_v4, ip_v6, status`
Snippet:
```
{"connected":true,"ip_v4":"192.168.1.35","ip_v6":"2401:4900:8fef:a440:ae02:e0f1:7805:a92e","ssid":"Airtel_Toybook","status":"ok"}

```
### audio
URL: `http://127.0.0.1:8000/api/v1/audio`
Status: `PASS`
HTTP: `200`
Latency: `111` ms
Content-Type: `application/json`
Present keys: `volume_percent, muted, status`
Snippet:
```
{"muted":false,"status":"ok","volume_percent":100}

```